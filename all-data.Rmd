---
title: "Current Data"
output:
  html_document:
    toc: no
    highlight: tango
editor_options:
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(dpi = 300)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)


source(here::here('R', '00_vis_custom.R'))
source(here::here('R', '00_load-packages.R'))
```

```{r load-data, include = FALSE, results = FALSE}

source(here::here('R', '02_load_data.R'))
source(here::here('R', '03_wrangle_data.R'))

```

Contains all data from both ISCO and tank collection methods from all reserves that submitted data.

# TAL Sensor CHLA (RFU) vs. Extracted CHLA ($\mu$g/L) {.tabset .tabset-pills}

## All 

```{r}
source(here::here('R', '04.1_all-figures.R'))

all_figure
```

## Reserve and Methods

Current Data with reserves and the methods pulled out.

```{r}
all_reserve_method_figure
```

## Reserve and Methods (Interactive)

**How to use the interactive plot:** Hover over interactive plot for the tools panel to appear in top-right corner. Tools include: save plot, zoom, select (lasso or box), and data compare. Hover your cursor over a point for more information. You can also double click on an item in the legend to isolate that data series in the plot!

```{r, dpi = 120}
ggplotly(
  all %>% 
    dplyr::filter(qaqc == 0) %>% 
    ggplot(aes(x = chlorophyll_rfu, y = chla_ugl)) +
    geom_point(aes(color = reserve_code, shape = method), position = "jitter") +
    stat_smooth(method = "lm", color = "black", se = FALSE) +
    scale_colour_manual(name = "Reserve", values = reservecolours) +
    scale_shape_discrete(name = "Method") +
    scale_y_continuous(expand = c(0,0)) +
    theme_classic() +
    labs(x = "Chlorophyll a (RFU) EXO",
         y = "Chlorophyll a (ug/L) Extracted",
         caption = "ISCO and tank experiments"),
  tooltip = c("method", "chlorophyll_rfu", "chla_ugl", "reserve_code")
  )
```

## Tank vs ISCO

```{r}
tank_isco
```

{-}



# Interference Parameters 

These are the three parameters of interest in the interference testing studies. The following is the chlorophyll a fluorescence (RFU) from the EXO total algae sensor by the extracted $\mu$g/L with the three parameters of interest overlayed as color.

## fDOM {.tabset .tabset-pills}

### Still

```{r fdom-interf}

fdom

```

### Interactive

**How to use the interactive plot:** Hover over interactive plot for the tools panel to appear in top-right corner. Tools include: save plot, zoom, select (lasso or box), and data compare. Hover your cursor over a point for more information.

```{r fdom-interf-interact, dpi = 120}

ggplotly(all %>%
           filter(chlorophyll_rfu > 0) %>%
           ggplot(aes(x = chlorophyll_rfu, y = chla_ugl, group = reserve_code)) +
           geom_point(aes(color = fdom_qsu), size = 3) +
           scale_color_continuous(name = "fDOM QSU") +
           theme_classic() +
           labs(x = 'Chlorophyll a RFU EXO',
                y = 'Chlorophyll a ug/L Extracted',
                title = "fDOM",
                caption = "Both Tank and ISCO Experiments"),
         tooltip = c("fdom_qsu", "chlorophyll_rfu", "chla_ugl", "reserve_code"))

```

{-}

## Turbidity {.tabset .tabset-pills}

Had to filter to remove turbidity values > 240 NTU due to an outlier.

### Still

```{r turb-interf}

turb
```

### Interactive

**How to use the interactive plot:** Hover over interactive plot for the tools panel to appear in top-right corner. Tools include: save plot, zoom, select (lasso or box), and data compare. Hover your cursor over a point for more information.

```{r turb-interf-interact, dpi = 120}
ggplotly(all %>%
           filter(chlorophyll_rfu > 0 & turb < 240) %>%
           ggplot(aes(x = chlorophyll_rfu, y = chla_ugl, group = reserve_code)) +
           geom_point(aes(color = turb), size = 3) +
           scale_color_continuous(name = "Turbidity NTU")  +
           theme_classic() +
           labs(x = 'Chlorophyll a RFU EXO',
                y = 'Chlorophyll a ug/L Extracted',
                title = "Turbidity", caption = "Both Tank and ISCO Experiments"),
         tooltip = c("turb", "chlorophyll_rfu", "chla_ugl", "reserve_code"))

```

{-}

## Temperature {.tabset .tabset-pills}

### Still

```{r temp-interf}
temp

```

### Interactive

**How to use the interactive plot:** Hover over interactive plot for the tools panel to appear in top-right corner. Tools include: save plot, zoom, select (lasso or box), and data compare. Hover your cursor over a point for more information.

```{r temp-interf-interact, dpi = 120}

ggplotly(all %>%
           filter(chlorophyll_rfu > 0) %>%
           ggplot(aes(x = chlorophyll_rfu, y = chla_ugl)) +
           geom_point(aes(color = temp), size = 3) +
           scale_color_gradient(name = 'Temperature C',
                                low="blue", high="red") +
           scale_color_continuous(name = expression(paste('Temperature ', "(", degree, "C)"))) +
           theme_classic() +
           labs(x = 'Chlorophyll a RFU EXO',
                y = 'Chlorophyll a ug/L Extracted',
                title = "Temperature"),
         tooltip = c("temp", "chlorophyll_rfu", "chla_ugl", "reserve_code"))

```

{-}
